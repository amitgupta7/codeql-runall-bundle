# Using a static initialization vector for encryption
A cipher needs an initialization vector (IV) when it is used in certain modes such as CBC or GCM. Under the same secret key, IVs should be unique and ideally unpredictable. Given a secret key, if the same IV is used for encryption, the same plaintexts result in the same ciphertexts. This lets an attacker learn if the same data pieces are transferred or stored, or this can help the attacker run a dictionary attack.


## Recommendation
Use a random IV generated by `SecureRandom`.


## Example
The following example initializes a cipher with a static IV which is unsafe:


```java
byte[] iv = new byte[16]; // all zeroes
GCMParameterSpec params = new GCMParameterSpec(128, iv);
Cipher cipher = Cipher.getInstance("AES/GCM/PKCS5PADDING");
cipher.init(Cipher.ENCRYPT_MODE, key, params);
```
The next example initializes a cipher with a random IV:


```java
byte[] iv = new byte[16];
SecureRandom random = SecureRandom.getInstanceStrong();
random.nextBytes(iv);
GCMParameterSpec params = new GCMParameterSpec(128, iv);
Cipher cipher = Cipher.getInstance("AES/GCM/PKCS5PADDING");
cipher.init(Cipher.ENCRYPT_MODE, key, params);
```

## References
* Wikipedia: [Initialization vector](https://en.wikipedia.org/wiki/Initialization_vector).
* National Institute of Standards and Technology: [Recommendation for Block Cipher Modes of Operation](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf).
* National Institute of Standards and Technology: [FIPS 140-2: Security Requirements for Cryptographic Modules](https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.140-2.pdf).
* Common Weakness Enumeration: [CWE-329](https://cwe.mitre.org/data/definitions/329.html).
* Common Weakness Enumeration: [CWE-1204](https://cwe.mitre.org/data/definitions/1204.html).
